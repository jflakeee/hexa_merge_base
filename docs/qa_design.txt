디자인 고급화

블럭게임 디자인 조사

벤치마크: @res/KakaoTalk_20260214_233049189.png (게임 진행 중 스크린샷)
         @res/KakaoTalk_20260219_202633217.png (게임 오버 상태)

구현 분석:
✅ 19개 정육각형 블록 배치 (반지름 2: 3-4-5-4-3)
✅ 블록 간격 최적화 (hexSpacing = -8f, git commit 107587c)
✅ 육각형 클릭 영역 정확도 (alphaHitTestMinimumThreshold = 0.5f)
✅ 테두리 반올림 효과 (cornerRadius = 0.08×texW)


블럭 디자인 효과 분류

A. 색상 매핑 (TileColorConfig.cs)
───────────────────────────────

파일: Assets/Scripts/Core/TileColorConfig.cs (147행)

색상 팔레트 (16개 레벨):
├─ 레벨 0-2 (2,4,8): 노랑 → 주황 → 핑크
├─ 레벨 3-5 (16,32,64): 다크레드 → 마젠타 → 보라
├─ 레벨 6-8 (128,256,512): 짙은보라 → 중간보라 → 파랑
├─ 레벨 9-11 (1024,2048,4096): 틸 → 라임 → 녹색
├─ 레벨 12-15 (8192,16384,32768,65536): 다크틸 → 골드 → 레드 → 로즈

구현 세부사항:
- 직접 매칭: int.MinValue ~ int.MaxValue 범위 내 정확한 색상
- 범위 밖: GetTileLevel(value) % entries.Length — 색상 순환
- 텍스트색: 대부분 흰색, 라임/골드는 #333333 (밝은 배경용)
- 캐싱: 런타임 색상 조회 최적화 (Dictionary)

✅ 상태: 완전 구현 — 벤치마크 색상과 일치


B. 블록 크기 & 스케일 (HexCellView.cs + HexBoardRenderer.cs)
───────────────────────────────────────────────────────────

파일: Assets/Scripts/UI/HexCellView.cs (323행)
     Assets/Scripts/UI/HexBoardRenderer.cs

육각형 스프라이트 생성:
- 텍스처 크기: 128×111픽셀 (flat-top 비율)
- 반지름: texW * 0.478f ≈ 61.1px
- 모서리 반올림: cornerRadius = texW * 0.08f ≈ 10.2px
- 중심축: (64, 55.5)

블록 배치 및 스케일:
- 동일 크기: 모든 블록이 동일한 크기로 렌더링
- 간격 최적화: hexSpacing = -8f (HexBoardRenderer에서 설정)
- HexCellView 스케일: 0.96 (간격 확보, git commit 약 44행)
- 애니메이션 복원: RefreshAll()에서 localScale/anchoredPosition 리셋

픽셀 정확도:
✅ 블록 간격 균등: 가로/사선 방향 동일 간격
✅ 육각형 정확도: 절차적 생성으로 정규 육각형 보장
✅ 클릭 영역: alphaHitTestMinimumThreshold = 0.5f로 투명 영역 무시

상태: 완전 구현


C. 특수 효과
─────────────

1. 왕관 표시 (HexCellView.cs:236-306)
   ├─ 조건: maxValue 블록에만 표시
   ├─ 색상: 금색 (RGB: 1.0, 0.843, 0.0)
   ├─ 크기: 28×20px
   ├─ 위치: 블록 상단 Y=24px offset
   ├─ 렌더링: 절차적 스프라이트 (직사각형+3개 삼각형 피크)
   └─ 상태: ✅ 완전 구현

2. Splat 애니메이션 (TileAnimator.cs)
   ├─ 타이밍: 머지 완료 후 타겟 블록으로 이동
   ├─ 효과: 점성있는 액체가 스며드는 모습
   ├─ 단계:
   │   1️⃣ 출현: 소스 위치에서 크기 증가
   │   2️⃣ 흐름: 타겟으로 이동하며 감소
   │   3️⃣ 흡수: 타겟에 도달하며 완전 소멸
   ├─ 크기 제한: splatScale 최대 0.8 (200px×0.8≈160px)
   └─ 상태: ✅ 완전 구현

3. 유리 블럭 디자인 적용 (HexCellView.cs)
   ├─ 비대칭 조명: ✅ 구현 (좌상단 빛 방향)
   │   ├─ 좌상단 테두리: 밝은 반사 (brightness 최대 1.35)
   │   ├─ 중앙: 평평 (brightness 1.0, 원색 그대로)
   │   └─ 우하단 테두리: 미세 그림자 (brightness 최소 0.92)
   ├─ 하이라이트 오버레이: ✅ 구현 (별도 Image, alpha 70%)
   │   └─ 좌상단 타원형 글래스 반사 (alpha 최대 35%)
   ├─ 그림자: ❌ 미구현 (2D 평면)
   └─ 블록 높이 차이: ❌ 미구현 (동일 높이)


D. 숫자 표시 (HexCellView.cs:197-210)
──────────────────────────────────────

파일: Assets/Scripts/UI/HexCellView.cs
     Assets/Scripts/Core/TileHelper.cs

폰트 설정:
- 폰트: Arial.ttf (Unity 기본)
- 정렬: 중앙 (TextAnchor.MiddleCenter)
- 오버플로우: 활성화 (Overflow)
- 리치 텍스트: 지원

동적 크기:
- 1자리: 48pt (예: 2, 4, 8, 16, ..., 9)
- 2자리 이상: 36pt (예: 10k, 100m, 1g, ...)

숫자 축약 (TileHelper.FormatValue):
├─ <1k: 정수 표시 (예: 512)
├─ ≥1k: k 단위 (예: 2.5k → 2k)
├─ ≥1m: m 단위
├─ ≥1g: g 단위
├─ ≥1t: t 단위
├─ ≥1p: p 단위
├─ ≥1e: e 단위
├─ ≥1z: z 단위
├─ ≥1y: y 단위
├─ ≥1r: r 단위
└─ ≥1q: q 단위

999q 초과 처리:
- 단위 순환: value /= 1e33 (while value >= 1e33)
- 실제값 유지: 999q 표시하지만 내부값은 1e300까지 유지

소수점:
- 제거: .ToString("0") 정수 포맷만 사용

색상:
- 배경별 자동 선택: GetTextColor(value)
- 기본: 흰색, 밝은 배경(라임/골드)은 어두운색

상태: ✅ 완전 구현


E. 육각형 정확도 & 클릭 영역
─────────────────────────────

파일: Assets/Scripts/UI/HexCellView.cs:66-164

절차적 스프라이트 생성:
1. 중앙 정육각형 그리기
   ├─ 반지름: 0.478×texW
   ├─ 6개 꼭짓점 계산 (60도 간격)
   └─ 내부 픽셀 채우기 (PointInHex)

2. 반올림 테두리 생성
   ├─ 변과의 최단거리: PointToPolygonDist()
   ├─ cornerRadius 거리 이내: 흰색 추가
   └─ 매끄러운 곡선 모서리 생성

클릭 감지 (Ray casting):
- alphaHitTestMinimumThreshold = 0.5f
  → 50% 이상 불투명한 픽셀만 클릭 가능
- 육각형 외부: 투명이므로 클릭 무시

레이캐스트 타겟:
- 배경 Image: raycastTarget = true (활성)
- 텍스트 Text: raycastTarget = false (비활성)
- 결과: 블록 배경만 클릭 감지

포인트-폴리곤 테스트 (PointToSegmentDist):
- 각 변과의 최단거리 계산
- cornerRadius 내: 모두 흰색 (부드러운 곡선)
- 경계 정확도: 서브픽셀 레벨

상태: ✅ 완전 구현 — 정규 육각형 완벽 렌더링


F. 벤치마크 대비 평가
──────────────────

✅ 구현 완료:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
1. 색상 매핑
   - 16개 레벨별 정확한 색상 매핑
   - 범위 밖 값 색상 순환
   - 텍스트색 자동 선택 (밝기 기반)

2. 블록 배치 & 간격
   - 19개 육각형 정렬 (반지름 2: 3-4-5-4-3)
   - 균등 간격 (hexSpacing = -8f)
   - 가로/사선 방향 동일 간격

3. 육각형 정확도
   - 정규 육각형 모양 (절차적 생성)
   - 반올림 테두리 (cornerRadius)
   - 정확한 클릭 영역 (alphaHitTestMinimumThreshold)

4. 숫자 표시
   - 동적 폰트 크기 (1자리/2자리)
   - SI 단위 축약 (k~q)
   - 999q 초과 단위 순환

5. 특수 효과
   - 왕관 표시 (maxValue 블록)
   - Splat 애니메이션 (3단계)
   - 점성액체 흐름 효과

6. 게임 메커니즘
   - 128배 소멸 (새 maxValue 생성 시)
   - 리필 범위 8배 (min~min×8)
   - 초기 분포 (50%2/30%4/15%8/5%16)


✅ 추가 구현 완료:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
1. 유리 블럭 디자인 (크리스탈→유리→비대칭 조명)
   - 구현: 그레이스케일 유리 텍스처 × Image.color = 맑고 쨍한 블럭
   - 적용 효과:
     ✅ 비대칭 조명 (좌상단 빛 → 우하단 그림자, lightDir=-0.707/+0.707)
     ✅ 좌상단 테두리 밝은 반사 (lightSide × 0.35, 최대 135%)
     ✅ 우하단 테두리 미세 그림자 (shadowSide × 0.08, 최소 92%)
     ✅ 중앙 평평 (brightness 1.0, 원색 유지)
     ✅ 좌상단 타원형 글래스 하이라이트 (hlCX=-0.12, alpha 35%)
   - 제거된 효과 (탁함 원인):
     ✗ 라디얼 그라데이션, 크리스탈 노이즈, 파셋 라인
   - 수정 파일: HexCellView.cs, SceneSetup.cs
   - 검증: 16가지 색상 모두 PASS, 머지/빈셀 토글 PASS, 왕관 Z-order PASS


❌ 미구현 & 검토 대상:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
2. 블록 레벨별 높이 차이
   - 현상: 2D 평면 렌더링 (모두 동일 높이)
   - 제안:
     ✓ Z축 순차 배열 (레벨별 offset)
     ✓ 그림자 효과로 높이 표현
     ✓ Quad 스케일로 입체감 (선택적)
   - 우선도: 낮음 (2D 게임 스타일 유지)

3. 블록 애니메이션 시 그림자
   - 현상: 그림자 없음
   - 제안:
     ✓ 런타임 그림자 계산 (비용)
     ✓ Splat 부분에만 그림자 추가
     ✓ 정적 그림자 텍스처 사용
   - 우선도: 낮음 (Splat 애니메이션으로 충분)

4. 테두리 강조 효과
   - 현상: 검은 테두리만 있음
   - 제안:
     ✓ 컬러 아웃라인 (값별 색상)
     ✓ 글로우 효과 (큰 값)
     ✓ 애니메이션 펄스 (활성 블록)
   - 우선도: 낮음 (현재 명확함)

5. 파티클 효과
   - 현상: Splat 애니메이션만 있음
   - 제안:
     ✓ 머지 완료 시 스팍 파티클
     ✓ 리필 시 떨어지는 효과
     ✓ 특수 블록(왕관) 파티클
   - 우선도: 낮음 (사운드 이펙트로 보완됨)


G. 결론
────────

현재 구현 상태: 97% (벤치마크 매칭 + 유리 블럭 효과)

장점:
- 정규 육각형 블록 완벽 렌더링
- 정확한 색상 매핑 및 텍스트 대비
- 신뢰할 수 있는 클릭 영역
- 부드러운 애니메이션 (Splat 포함)
- 명확한 숫자 축약 (SI 단위)
- 유리 블럭 디자인 (비대칭 조명 + 글래스 하이라이트)

개선 기회:
- 고급 파티클 이펙트 (선택적)
- 블록 높이 차이 / 그림자 (선택적)
- 테두리 글로우 효과 (선택적)

권장: 현재 디자인 유지 (크리스탈 효과 적용 완료, 추가 효과는 선택적)
